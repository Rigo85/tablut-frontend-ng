<div class="app-shell">
  <header class="topbar">
    <div>
      <h1>Tablut</h1>
      <p class="subtitle">Cartier Variant - Humano vs Bot</p>
    </div>
    <div class="top-actions">
      <button class="btn ghost" (click)="onNewGameClick()">Nueva partida</button>
      <button class="btn" [disabled]="loading()" (click)="onDifficultyChange(2)">Nivel 2</button>
      <button class="btn" [disabled]="loading()" (click)="onDifficultyChange(4)">Nivel 4</button>
    </div>
  </header>

  <section class="status-row" *ngIf="state() as st">
    <span>Juego: <strong>{{ st.id }}</strong></span>
    <span>Humano: <strong>{{ st.humanSide }}</strong></span>
    <span>Bot: <strong>{{ st.botSide }}</strong></span>
    <span>Turno: <strong>{{ turnLabel() }}</strong></span>
    <span>Dificultad: <strong>{{ st.difficulty }}</strong></span>
  </section>

  <section class="message" *ngIf="message()">{{ message() }}</section>

  <main class="board-and-log" *ngIf="state() as st">
    <div class="board-wrap">
      <div class="board">
        <div class="row" *ngFor="let r of rows">
          <button
            type="button"
            class="cell"
            *ngFor="let c of cols; trackBy: trackByCell"
            [class.cell-edge]="isEdge(r, c)"
            [class.cell-throne]="isThrone(r, c)"
            [class.cell-selected]="isSelected(r, c)"
            [class.cell-target]="isTarget(r, c)"
            [disabled]="loading() || st.phase === 'GAME_OVER'"
            (click)="onCellClick(r, c)"
          >
            <span [class]="cellPieceClass(r, c)">{{ cellLabel(r, c) }}</span>
          </button>
        </div>
      </div>
    </div>

    <aside class="log-panel">
      <h2>Bit√°cora</h2>
      <ul>
        <li *ngFor="let item of logs()">{{ item }}</li>
      </ul>
    </aside>
  </main>

  <div class="setup-overlay" *ngIf="setupOpen()">
    <div class="setup-card">
      <h2>Iniciar partida</h2>
      <p>Elige tu bando y dificultad del bot.</p>

      <div class="setup-block">
        <label>Bando humano</label>
        <div class="side-buttons">
          <button class="btn" [class.active]="setupHumanSide() === 'DEFENDER'" (click)="onSelectHumanSide('DEFENDER')">
            DEFENDER
          </button>
          <button class="btn" [class.active]="setupHumanSide() === 'ATTACKER'" (click)="onSelectHumanSide('ATTACKER')">
            ATTACKER
          </button>
        </div>
      </div>

      <div class="setup-block">
        <label>Dificultad</label>
        <div class="side-buttons">
          <button class="btn" [class.active]="setupDifficulty() === 2" (click)="setupDifficulty.set(2)">2</button>
          <button class="btn" [class.active]="setupDifficulty() === 4" (click)="setupDifficulty.set(4)">4</button>
        </div>
      </div>

      <button class="btn primary" [disabled]="loading() || setupSubmitting()" (click)="startNewGame()">
        {{ setupSubmitting() ? 'Creando partida...' : 'Comenzar' }}
      </button>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="loading()">
    <div class="loading-card">
      <span class="spinner"></span>
      <p>Procesando jugada y sincronizando estado...</p>
    </div>
  </div>
</div>
